<!doctype html>
<html>
    <head>
        <!-- jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

        <!-- Bootstrap -->
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

        <script>
            $(document).ready( WireEvents );

            function WireEvents(){
                $('#btnJoin').click( do_join_button );
            };

            function do_join_button(){
                var s = $('#txtSession').val();
                var url = "http://localhost:5000/votecalc/session/" + s;
                fetch_json(url);
            };

            function fetch_json(server_url) {
                $.ajax({
                    url: server_url,
                    type: 'GET',
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader('Authorization', make_base_auth('voter', 'cast'));
                    },
                    dataType: 'json',
                    crossDomain: true,
                    jsonp: false,
                    success: function (data) { parseResponse(data) },
                    error: function (xhr, status, error) {
                        var err = eval("(" + xhr.responseText + ")");
                        alert('Error in ajax call: ' + err.Message);
                    }
                });
            }

            function parseResponse(data) {
                var x = JSON.stringify(data);
                alert('parsed: ' + x);
                $('#TestData').html(x);
            }

            function make_base_auth(user, password) {
                var tok = user + ':' + password;
                var hash = btoa(tok);
                return 'Basic ' + hash;
            }

        </script>
    </head>

    <body>
    <div class="container">

        <div class="row">
            <span class="col-xs-6 col-sm-4">Session Number:</span>
            <span class="col-xs-6 col-sm-4"><input class="col-md-4" id="txtSession" value="LU93" type="text"/></span>
            <span class="col-xs-6 col-sm-4"><input id="btnJoin" type="button" value="Join" /></span>
            <span class="col-xs-6 col-sm-4 invisible" id="session_id">nnnnnn</span>
        </div>
        <div class="row">
            <span class="col-xs-6 col-sm-4">Title:</span>
            <span class="col-xs-6 col-sm-4" id="title">not joined yet</span>
        </div>

        <div class="row" id="TestData">
            <span class="col-xs-6 col-sm-4">no test data yet</span>
        </div>
    </div>
    </body>

</html>